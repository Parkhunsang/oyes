<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:insert="~{/header.html::header}"></th:block>
<head><meta charset="UTF-8"><title>Insert title here</title>
<style type="text/css">
	/* drop & drag */
	.drag-over { background: yellow; }
	.thumb { width: 100px; padding: 2px; float: left; }
	.thumb > img { width: 100%; }
	.thumb > .close { position: absolute; background: red; cursor: pointer; }
	#drop { border: 1px solid black; width: 300px; height: 200px; padding: 3px; }
</style>
<script type="text/javascript">
	function chk() {
		if (frm.password.value != frm.password2.value) {
			alert("암호와 암호 확인이 다릅니다")
			frm.password.value="";
			frm.password2.value=""
			frm.password.focus()
			return false;
		}
	}
	// drag & drop
 	$(document).on("drop", function(e) {
		// 태그에 파일 넣기
		$('input[type="file"]').prop("files", e.originalEvent.dataTransfer.files);
	});
	$(function() {
		let uploadfiles = []; // 파일 배열(여러개 파일 사용 가능)
		let $drop = $('#drop');
		$drop.on('dragenter', function() { // 마우스로 드래그해서 파일이 박스에 들어오면
			$('#thumbnails').text(""); // 글자 삭제
			$(this).addClass('drag-over');
		}).on('dragleave', function() { // 드래그 한 요소가 나갔을 때
			$('#thumbnails').text("그림을 올려 놓으세요");
			$(this).removeClass('drag-over');
		}).on('dragover', function(e) { // 드래그 한 그림을 떨어뜨리기 위해 위에 올려좠을 때
			e.stopPropagation(); // 이벤트를 전달하지 마라
			e.preventDefault();  // 원래 기능을 하지 마라
		}).on('drop', function(e) { // 드래그 한 그림을 떨어 뜨렸을 떄
			e.preventDefault();
			$(this).removeClass('drag-over');
			let files = e.originalEvent.dataTransfer.files;
			for (let i = 0; i < files.length;i++) {
				let file = files[i];
				let size = uploadfiles.push(file); // 드래그한 그림을 배열에 넣기
				preview(file); // 넣은 파일 미리 보기
			}
		});
		$('#thumbnails').on('click', function(e) {
			let $target = $(e.target);
			let idx = $target.attr('data-index');
			$target.parent().remove(); // x를 클릭한 그림 삭제
		});
	});
	// 그림 보여주기
	function preview(file) {
		var reader = new FileReader();
		reader.onload = (function(f) {
			return function(e) {
				let div = '<div class="thumb"><div class="close">X</div><img src="'+
					e.target.result+'"/></div>';
				$('#thumbnails').append(div);
			};
		})(file);
		reader.readAsDataURL(file);
		// readAsDataURL: 컨텐츠의 특정 Blob이나 File에서 읽어오는 역할을 수행 
	}
</script>
</head><body>
<div class="container text-center">
	<h2 class="text-primary">회원정보 수정</h2>
<form action="update" method="post" enctype="multipart/form-data" name="frm" onsubmit="return chk()">
	<input type="hidden" name="id" th:value="${member.id}">
<table class="table table-bordered table-info">
	<tr><td>아이디 <i class="bi bi-file-earmark-person icofont-2x"></i></td>
		<td>[[${member.id}]]</td></tr>
	<tr><td>암호 <i class="bi bi-file-lock2 icofont-2x"></i></td>
		<td><input type="password" name="password" required="required" class="form-control"
			autofocus="autofocus"></td></tr>
	<tr><td>암호확인 <i class="bi bi-file-lock2 icofont-2x"></i></td>
		<td><input type="password" name="password2" required="required" class="form-control"></td></tr>
	<tr><td>이름 <i class="bi bi-person-vcard icofont-2x"></i></td>
		<td><input type="text" name="name" required="required" class="form-control"
			th:value="${member.name}"></td></tr>
	<tr><td>이메일 <i class="bi bi-envelope icofont-2x"></i></td>
		<td><input type="email" name="email" required="required" class="form-control"
			th:value="${member.email}"></td></tr>
	<tr><td>사진 <i class="bi bi-file-earmark-person icofont-2x"></i></td>
		<td><input type="file" name="file" class="form-control"></td></tr>
	<!-- drag and drop -->
	<tr><th>사진 <i class="bi bi-file-earmark-person icofont-2x"></i></th>
		<td><div id="drop"><div id="thumbnails">
			<img th:src="@{/upload/}+${member.fileName}" 
			class="rounded img-thumbnail" width="200">
		</div></div></td></tr>
	<tr><td colspan="2" class="text-center">
		<input type="submit" value="수정" class="btn btn-primary"></td></tr>
</table>	
</form>
	<a href="loginForm" class="btn btn-info">로그인</a>
</div>
</body>
</html>