<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}"
>
	<th:block th:insert="~{/header.html::header}"></th:block>
<!-- 
	<link rel="shortcut icon" th:href="@{/asset/img/common/favicon_eumc.ico" type="image/x-icon}" />
	<link rel="stylesheet" th:href="@{/asset/css/common/feCommon_seoul.min.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/asset/slick/slick.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/asset/slick/slick-theme.css}"/>
	<script src="/asset/js/jquery.min.js"></script>
	<script src="/asset/js/jquery-ui.min.js"></script>
	<script src="/asset/js/webfont.min.js"></script>
	<script src="/asset/js/kuhCommon.js"></script>
	<script src="/asset/js/jquery.printThis.js"></script>
	<script src="/asset/js/common.js"></script>
 -->	

</head>
<body>
	<div layout:fragment="contentFragment">
		<!-- header -->
		<!-- //header -->

		<!-- container -->
		<div class="container">
			

		<div class="contTopBar contTopBar-bg01">
			<!-- inner -->
			<div class="inner">
				<!-- breadcrumb -->
				<div class="breadcrumb cf">
					<strong class="he">현재 위치:</strong>
					<div class="item">
						<a th:href="@{/}" class="home ht">Home</a>
					</div>
					
					<div class="item">
						<em>마이페이지</em>
						<button type="button" class="bcLinkLayerBtn ht">주 메뉴 목록 열기</button>
						<ul class="bcLinkLayer">
							<li><a th:href="@{/mypage/myreservation_1}">마이페이지</a></li>
						</ul>
					</div>
					<div class="item">
						<em>내 정보 관리</em>
						<button type="button" class="bcLinkLayerBtn ht">서브 메뉴 목록 열기</button>
						<ul class="bcLinkLayer">
							<li><a th:href="@{/mypage/myreservation_1}">외래진료 예약내역</a></li>							
							<li><a th:href="@{/mypage/myfavoritedoctor}">관심의료진 관리</a></li>							
							<li><a th:href="@{/mypage/mythank}">내가쓴글</a></li>							
							<li><a th:href="@{/mypage/myinfo}">내 정보 관리</a></li>							
						</ul>	
					</div>
					
				</div>
				<!-- //breadcrumb -->
				




<script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
<script type="text/javascript">
$(function(){
	var url = window.location.href;
	var dec = $('h2.title').text();
	var siteTitle = $('head title').text();
	Kakao.init('8a7ce70a0329833253a66ddde14fc28d');
	$(".twitter").click(function(){
		share('twitter', url, '', '',dec);
		return false;
	});
	
	$(".faceBook").click(function(){
		share('facebook', url, '', '',dec);
	});
	
	$("#kakaostory-share-button").click(function(){
		share("kakao", url, '', '',dec);
		return false;
	});
	
	$(".url").click(function(){
		copyToClipboard(url);
		alert('URL이 복사되었습니다.\nCtrl+v를 이용하여 붙여넣기하실 수 있습니다.');
	});
});


function copyToClipboard(val) {
  var t = document.createElement("textarea");
  document.body.appendChild(t);
  t.value = val;
  t.select();
  document.execCommand('copy');
  document.body.removeChild(t);
}
	
function share(gubn, surl, imgLink, gname, dec) {
	console.log(surl + ' // ' + dec)
	if (gubn == 'twitter') {
  	window.open('http://twitter.com/share?text='+encodeURIComponent('이화여자대학교병원 | ' + dec)+'&url=' + encodeURIComponent(surl),'twittershare','width=500,height=400,scrollbars=no,resiable=no');
	} else if (gubn == "facebook") {
		var ua = navigator.userAgent;
		var slink = "https://www.facebook.com/dialog/feed?app_id=922614774754618&redirect_uri=" + encodeURIComponent(surl) + "&link=" + encodeURIComponent(surl);
		if (ua.indexOf("PIBS_APP") > -1) {
			document.location.href = slink;
		} else {
			window.open(slink,"facebook","width=1000,height=520,scrollbars=no,resiable=no");
		}
	} else {
    Kakao.Link.sendDefault({
    	objectType: 'feed',
    	content: {
      	title: dec,
        description: dec,
        imageUrl: 'https://seoul.eumc.ac.kr/asset/img/common/kakao_img.png',
        link: {
        	mobileWebUrl: surl,
          webUrl: surl
        }
      }
    });
	}
}

function defaultMailReg() {
	var url = '/common/emailReg.do';

	$.ajax({
		type: "GET",
		url: url,
		success: function(data)
		{
			feUI.modalMethod.viewLayer('modal-defaultMail');
			$("#defaultMailReg").html(data);
		}
	});
}

//인쇄
function printMain(obj){
	//common.print($("#content"), $("head title").text());
	document.print();
}
</script>
<div class="utilMenu">
	<a href="javascript:void(0)" role="button" class="email modalJs" onclick="defaultMailReg();"><i class="icon-email ht">메일</i></a>
	<div class="cont">
		<a href="#" role="button"><i class="icon-share ht">관심콘텐츠</i></a>
		<ul>
			<li><a href="#" role="button" class="twitter"><i class="icon-twitter ht">트위터</i></a></li>
			<li><a href="#" role="button" class="faceBook"><i class="icon-faceBook ht">페이스북</i></a></li>
			<li><a href="#" role="button" class="kakao" id="kakaostory-share-button"><i class="icon-kakao ht">카카오</i></a></li>
			<li><a href="#" role="button" class="url"><i class="icon-url ht">URL 공유</i></a></li>
		</ul>
	</div>
	<a th:href="@{/}" role="button" class="print" onclick="printMain(this);"><i class="icon-print ht">프린트</i></a>
	<span class="zoomOut">
		<button type="button" class="zoomOut minus ht">화면 축소</button>
	</span>
	<span class="zoomIn">
		<button type="button" class="zoomIn plus ht">화면 확대</button>
	</span>
</div>

<!-- 메일발송 레이아웃 -->
<section class="modal modal-sizeM modal-defaultMail" id="defaultMailReg"></section>
<!-- //메일발송 레이아웃 -->

			</div>
			<!-- //inner -->
		</div>
<script type="text/javascript">
		var locationInfo = {
			cate0: $(".viewTitle h3").text(),
			cate1: $(".breadcrumb em:eq(2)").text(),
			cate2: $(".breadcrumb em:eq(1)").text(),
			cate3: $(".breadcrumb em:eq(0)").text()
		}
</script>

				
				


<main id="content" class="content">
	<div class="inner">
		<div class="heading heading-depth01">
			<h2 class="title">내 정보 관리</h2>
		</div>
		<h3 class="he">내 정보 관리</h3>
		<!-- mypage_lnb -->
		




<!-- 마이페이지lnb -->
<div class="myInfo">
	<div class="info">
		<strong class="title">환자정보</strong>
		<ul class="bullet bullet-type01 bullet-inline">
			<li>
				이름
				<strong>[[${member.patient_name}]]</strong>
			</li>
			<li>
				환자번호
				<strong>[[${member.patient_no}]]</strong>
			</li>
			<li>
				휴대번호
				<strong>[[${member.mobile_no}]]</strong>
			</li>
		</ul>
	</div>
	<ul class="tab tab-col04">
		<li >
			<a th:href="@{/mypage/myreservation_1}">외래진료 내역 <i></i></a>
		</li>
		<li >
			<a th:href="@{/mypage/myfavoritedoctor}">관심의료진 관리</a>
		</li>
		<li >
			<a th:href="@{/mypage/mythank}">내가쓴글</a>
		</li>
		<li class="current">
			<a th:href="@{/mypage/myinfo}">내 정보 관리</a>
		</li>
	</ul>
</div>
<!-- //마이페이지lnb -->

<script type="text/javascript">
//마이페이지 환자번호 조회
$(function() {
	$('#ptnoChkBtn').click(function() {
		
		var now = new Date();
		var pastYear = now.getFullYear()-14;
		var month = now.getMonth()+1;
		var date = now.getDate();
		var pastToday;
		var imsiMonth = month < 10 ? "0" + month : month;
		var imsiday = date < 10 ? "0" + date : date;
		pastToday = pastYear + "" + imsiMonth + "" + imsiday;

		if('19710105' > pastToday) {
			callMyParentCertifyLayer();
		} else {
			callMySelfCertifyLayer();
		}
		
	});
});
</script>
		<!-- //mypage_lnb -->
		<form action="/mypage/info/infoModify.do" method="post">
        <form id="memberVo" name="UpdateMyinfo" th:action="@{/mypage/UpdateMyinfo}" method="post">
    		<input type="hidden" name="patient_no" id="patient_no" value="[[${member.patient_no}]]" />
    		<input type="hidden" name="patient_id" id="patient_id" value="[[${member.patient_id}]]" />
    		<input type="hidden" name="password" id="password" value="[[${member.password}]]" />
    		<input type="hidden" name="patient_name" id="patient_name" value="[[${member.patient_name}]]" />
			<fieldset>
				<legend>내 정보 수정</legend>
				<div class="card-mem">
					<div class="form-filed join">
						<div class="item">
							<strong class="title">아이디	</strong>[[${member.patient_id}]]
						</div>
						<div class="item">
							<strong class="title">환자번호</strong>[[${member.patient_no}]]
						</div>
						
						<div class="row">
							<div class="item">
								<strong class="title">이름</strong>
								[[${member.patient_name}]]
							</div>
							<div class="item">
								<strong class="title">생년월일</strong>
								[[${member.birth_date}]]
							</div>
						</div>
						<div class="item">
							<strong class="title">휴대번호</strong>
							<div class="address">
								<div class="filed">
									<input type="text" title="휴대폰번호" id="mobile_no" name="mobile_no" class="input form-sizeFull" required="required" th:value="${member.mobile_no}" maxlength="11" readonly="readonly" />
									<button type="button" class="button button-sizeL" id="certiBtn">번호변경</button>
								</div>
							</div>
							<p>※ 나이스평가정보에서 인증 받은 휴대폰 번호를 사용하고 있습니다.</p>
						</div>
						<div class="item">
							<strong class="title">이메일</strong>
							<div>
								<input type="text" title="이메일 주소" id="email" name="email" class="input" required="required" th:value="${member.email}" maxlength="30" />
								<span role="alert" class="validation" id="emailChkTxt"></span>
							</div>
						</div>
					</div>
				</div>
				<div class="btnWrap">
                    <button type="submit" class="button button-sizeM button-bg03" id="modBtn">수정</button>
				</div>
			</fieldset>
		</form>
		<div class="card-mem">
			<span>이대서울병원 회원 탈퇴를 원하시면 “회원탈퇴버튼”을 클릭하세요.</span>
			<button type="button" class="button button-sizeM fr" id="quitBtn">회원탈퇴</button>
		</div>
		<div class="panel panel-bg01 panel-tel">
			<div class="panel-body">
				<ul class="bullet bullet-type01 bullet-inline">
					<li>
						대표전화번호
						<strong class="bar">1522-7000</strong>
					</li>
					<li>
						응급의료센터
						<strong class="bar">02-6986-5119</strong>
					</li>
					<li>
						고객상담실
						<strong class="bar">02-6986-5573</strong>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<form name="form_chk" method="post">
		<input type="hidden" name="m" value="checkplusSerivce" />						<!-- 필수 데이타로, 누락하시면 안됩니다. -->
		<input type="hidden" name="EncodeData" value="AgAFQkY5MDSMtFOny60CUDRVA0KQAJYaAqnMg37mRVfSnBAtEIR1Pfte67bJdncczFNiZmgiTA+yVhGqbIskPH9wNtRR/Uoteqgs4Enp/WbYcZXLCAXimUzLAKbL6k99uCAtdqyOXcTGhRbpbtmcDDAIvLtTXgiT8D57VFqg4stBTfUgSbLM+0YKFckvMSXWLA49WZxUqLGOl8WERBm1lhrl0QoMaMgjgdcHNYJPA9ZBizHrCN68kqQluAHKaClqQLIx9FDsU+JGG8MdEjtQyWP+pQH85WOg9giMl7MG7q+JXT56CNGypNTZ+YRboK4Xa1mh63te9HDtWRk6EUg8SDkdtEufE2urQnwsuJ7TtLHc+WH6CcOADJJiJ9y68bsEJwUs6MkW2nbUmYubUA/uL9eSvNebkS8i+N1MltgOwJbiFLJ3gMyrnyFRHG9Pb8JULivcjZ+aRSmPoX+WX/EC75R0l8zvQPFJ9jewxslfh+MwaVxEh6OWI3uIQtn5OgUdKE/EgNL9KLiPRjlTyaUJF+zV7PEuD/4R" />		<!-- 위에서 업체정보를 암호화 한 데이타입니다. -->
	</form>
</main>

<script type="text/javascript">

	$(document).ready(function(){

		var passChk=/^[a-zA-Z0-9!@#$%^&*]{8,}$/;
		var emailChk = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/i;
		var emailPass = true;
		var pwdPass = true;
		
		// 본인인증버튼 클릭
		$('#certiBtn').click(function() {
			window.open('', 'popupChk', 'width=500, height=550, top=100, left=100, fullscreen=no, menubar=no, status=no, toolbar=no, titlebar=yes, location=no, scrollbar=no');
			document.form_chk.action = "https://nice.checkplus.co.kr/CheckPlusSafeModel/checkplus.cb";
			document.form_chk.target = "popupChk";
			document.form_chk.submit();
		});

		// 수정버튼 클릭
		$('#modBtn').click(function() {
			var form = $('#memberVo');
			var validCheck = true;
			
			if($('#email').val().trim() == "") {
				validCheck = false;
				$('#email').focus();
			}

			if(!emailPass) {
				alert("이메일을 확인해주세요.");
				return false;
			} else if(!pwdPass) {
				alert("비밀번호를 확인해주세요.");
				return false;
			} else {
				if(!validCheck) {
					alert("필수입력 항목을 확인해 주세요.");
				} else {
					var url='/mypage/info/infoModifyProcAjax.do';
					$('#email').val($('#email').val().trim());
					var data = form.serialize();

					$.ajax({
						type: "POST",
						url: url,
						data: data,
						success: function(data){
							if(data.result == 'success') {
								alert("회원 정보가 수정되었습니다.");
								location.reload();
							} else if(data.result == 'fail') {
								alert("회원 정보 수정에 실패하였습니다.");
								return false;
							} else if(data.result == 'error') {
								alert("비정상적인 접근입니다.");
								return false;
							}
						}
					});
				}
			}
		});

		//회원탈퇴버튼 클릭
		$('#quitBtn').click(function() {
			if(confirm("이대서울병원 홈페이지에서 탈퇴하시겠습니까?") == true) {
				var form = $('#memberVo');
				var id = $('#id').val();
				var hpno = $('#hp_no').val();
				var nm = $('#ptnm').val();
				var email = $('#email').val();
				var url = "/mypage/info/quitMemberAjax.do";

				$.ajax({
					type: "POST",
					url: url,
					data: {"id":id, "hp_no":hpno, "name":nm, "email":email},
					success: function(data)
					{
						if(data.result == 'success') {
							alert("회원탈퇴가 완료되었습니다.");
							location.href = "/logout.do";
						} else if(data.result == 'fail') {
							alert("회원탈퇴를 실패했습니다.");
							return false;
						} else if(data.result == 'error') {
							alert("비정상적인 접근입니다.");
							return false;
						}
					}
				});
			} else {
				return;
			}
		});
	});
</script>
			<section class="modal modal-sizeXS modal-alert" id="alertMsgLayer"></section>
			<!-- 진료시간표 레이아웃 -->
			<section class="modal modal-sizeL modal-schedule" id="modalSchedule"></section>
			<!-- //진료시간표 레이아웃 -->
		</div>
		<!-- //container -->

		<!-- footer -->
		<!-- //footer -->
	</div>
</body>
<script src="/asset/js/jquery.bxslider.js"></script>
<script src="/asset/js/feSeries.min.js"></script>
<script src="/asset/js/feCommon.js"></script>
</html>