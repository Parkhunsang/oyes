<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.oyes.mapper.DoctorMapper">

	<resultMap id="doctorResultMap" type="doctor">
		<id property="doctor_id" column="doctor_id"/>
		<result property="doctor_name" column="doctor_name"/>
		<result property="doctor_title" column="doctor_title"/>
		<result property="doctor_profile_image" column="doctor_profile_image"/>
		<result property="doctor_doctor_specialty" column="doctor_doctor_specialty"/>
		<result property="doctor_is_active" column="doctor_is_active"/>
		<result property="doctor_created_at" column="doctor_created_at"/>
		<result property="doctor_updated_at" column="doctor_updated_at"/>
		<result property="department_id" column="department_id"/>
		<result property="center_id" column="center_id"/>
		
		<result property="department_name" column="department_name"/> <!-- 의사 상세 정보에 진료과 이름 포함 -->
		
		<collection column="doctor_id" property="centerNames" ofType="java.lang.String" select="selectCenter">		
			<result column="center_name"/>
		</collection>
		
		<collection property="clinicList" ofType="ClinicSession">
			<result column="week"/>		
			<result column="amPm"/>		
		</collection>
		
	</resultMap>

	<select id="list" parameterType="int" resultMap="doctorResultMap">
		SELECT
		    d.*,
		    c.center_name
		FROM
		    doctor d,center c, center_doctor cd
		where d.doctor_id = cd.doctor_id and 
			 cd.center_id = c.center_id(+) and
		    d.department_id = #{departmentId}
	    order by num
	</select>
	
	<select id="listClinic" parameterType="int" resultMap="doctorResultMap">
		SELECT
		    d.*, dp.department_name,
		    c.center_name
		FROM
		    doctor d,center c, center_doctor cd, department dp
		where d.doctor_id = cd.doctor_id and 
			 cd.center_id = c.center_id(+) and
			 d.department_id = dp.department_id(+) and
		    d.center_id = #{centerId}
	    order by num
	</select>
	
	<select id="listC" parameterType="int" resultMap="doctorResultMap">
		SELECT
		    d.*, dp.department_name,
		    c.center_name
		FROM
		    doctor d, center c,  department dp, center_doctor cd
		where d.doctor_id = cd.doctor_id and d.department_id = dp.department_id(+) AND
			 cd.center_id = c.center_id(+) and cd.center_id=#{center_id}
	    order by num
	</select>
	
	<select id="selectCenter" parameterType="integer" resultType="string">
		select center_name from center where center_id in (select center_id from center_doctor where doctor_id=#{doctor_id}) 
	</select>
	
	<select id="select" parameterType="int" resultMap="doctorResultMap">
		SELECT
		    d.*,
		    dp.department_name, 
		    c.center_name       
		FROM
		    doctor d,
		    department dp,
		    center_doctor cd,
		    center c
		WHERE
		    d.department_id = dp.department_id(+) AND
		    d.doctor_id = cd.doctor_id(+) AND
		    cd.center_id = c.center_id(+) AND
		    d.doctor_id = #{doctor_id}
	</select>
	
</mapper>